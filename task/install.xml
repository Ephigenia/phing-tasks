<project>
	<!-- main tasks -->
	<target name="install" depends="submodules-install,install-yui-compressor,install-gems" description="install all libraries including bin and git submodules" />
	<target name="update" depends="submodules-update,install-yui-compressor,install-gems" description="update all libraries including bin and git submodules" />
	<!-- prepare stuff -->
	<target name="install-prepare">
		<mkdir dir="bin" />
		<mkdir dir="tmp/install" />
	</target>
	<target name="install-yui-compressor" depends="install-prepare">
		<fail unless="assets.yui.jar" message="assets.yui.jar location not set in build.properties." />
		<echo msg="downloading yahoo yui compressor ..." />
		<exec
			escape="false"
			passthru="true"
			checkreturn="true"
			command="wget http://yui.zenfs.com/releases/yuicompressor/yuicompressor-${assets.yui.version}.zip -O ${project.basedir}/tmp/install/yuicompressor-latest.zip" />
		<unzip file="tmp/install/yuicompressor-latest.zip" todir="tmp/install/" />
		<move file="tmp/install/yuicompressor-${assets.yui.version}/build/yuicompressor-${assets.yui.version}.jar" tofile="${assets.yui.jar}" overwrite="true" />
		<phingcall target="install-cleanup" />
	</target>
	<target name="submodules-install">
		<exec escape="false" checkreturn="true" passthru="true" command="git submodule init" />
		<phingcall target="submodules-update" />
	</target>
	<target name="submodules-list">
		<exec escape="false" checkreturn="true" passthru="true" command="cat .gitmodules" />
	</target>
	<target name="submodules-update">
		<echo level="info" msg="updating git submodules" />
		<exec escape="false" checkreturn="true" passthru="true" command="git submodule update --init --recursive" />
	</target>
	<target name="install-gems">
		<fail unless="ruby.gems" message="no ruby gems defined in ruby.gems" />
		<exec escape="false" checkreturn="true" passthru="true" command="gem update --system" />
		<exec escape="false" checkreturn="true" passthru="true" command="gem install ${ruby.gems}" />
	</target>
	<target name="install-cleanup">
		<delete dir="tmp/install" includeemptydirs="true" verbose="true" failonerror="true" />
	</target>
</project>