<project>
	<filelist id="javascript-app-files" dir="${assets.root}/${assets.js.soure-dir}" files="${assets.js.files}" />
	<target name="jslint" description="jslint-validate all application javascript files">
		<jsllint haltonfailure="true" showwarnings="false">
			<fileset dir="${assets.root}/${assets.js.soure-dir}">
				<include name="**/*.js"/>
			</fileset>
		</jsllint>
	</target>
	<target name="javascript-compress" description="javascript packing/compiling">
		<!-- install yui compressor if not present -->
		<if>
			<not><available file="./${assets.yui.jar}" /></not>
			<then>
				<phingcall target="install-yui-compressor" />
			</then>
		</if>
		<mkdir dir="${assets.root}/${assets.js.target-dir}" />
		<!-- default values -->
		<property name="assets.js.target-filename" value="app.js" />
		<property name="assets.yui.extra" value="" />
		<!-- generated default values -->
		<property name="source" value="${assets.root}/${assets.js.target-dir}/app.js.tmp" />
		<property name="target" value="${assets.root}/${assets.js.target-dir}/${assets.js.target-filename}" />
		<delete file="${target}" />
		<delete file="${source}" />
		<append destFile="${source}">
			<filelist refid="javascript-app-files" />
		</append>
		<exec checkreturn="true" passthru="true" command="java -jar ${assets.yui.jar} --type js ${assets.yui.extra} ${source} -o ${target}" escape="false" />
		<filesize propertyname="fileSizeUncompressed" file="${source}" />
		<filesize propertyname="fileSizeCompressed" file="${target}" />
		<php expression="round(${fileSizeCompressed}/${fileSizeUncompressed} * 100, 2)" returnProperty="compressionRatio" />
		<php expression="round(${fileSizeUncompressed} / 1024, 3)" returnProperty="fileSizeUncompressed" />
		<php expression="round(${fileSizeCompressed} / 1024, 3)" returnProperty="fileSizeCompressed" />
		<echo msg="closure-compiler done (${fileSizeUncompressed}KB to ${fileSizeCompressed}KB, ratio: ${compressionRatio}%)" />
		<delete file="${source}" />
	</target>
</project>